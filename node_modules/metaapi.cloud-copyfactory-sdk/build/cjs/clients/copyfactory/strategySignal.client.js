"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, /**
 * CopyFactory client for strategy signal requests
 */ "default", {
    enumerable: true,
    get: function() {
        return StrategySignalClient;
    }
});
const _randomstring = /*#__PURE__*/ _interop_require_default(require("randomstring"));
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
let StrategySignalClient = class StrategySignalClient {
    /**
   * Constructs CopyFactory strategy signal client instance
   * @param {string} accountId strategy provider id
   * @param {string} strategyId strategy id
   * @param {Object} host host data
   * @param {DomainClient} domainClient domain client
   */ constructor(accountId, strategyId, host, domainClient){
        this._accountId = accountId;
        this._strategyId = strategyId;
        this._domainClient = domainClient;
        this._host = host;
    }
    /**
   * Generates random signal id
   * @return {String} signal id
   */ generateSignalId() {
        return _randomstring.default.generate(8);
    }
    /**
   * CopyFactory external signal update payload
   * @typedef {Object} CopyFactoryExternalSignalUpdate
   * @property {String} symbol trade symbol
   * @property {String} type trade type (one of POSITION_TYPE_BUY, POSITION_TYPE_SELL, ORDER_TYPE_BUY_LIMIT, ORDER_TYPE_SELL_LIMIT, 
   * ORDER_TYPE_BUY_STOP, ORDER_TYPE_SELL_STOP)
   * @property {Date} time time the signal was emitted at
   * @property {Date} [updateTime] last time of the signal update
   * @property {Number} volume volume traded
   * @property {Number} [magic] expert advisor id
   * @property {Number} [stopLoss] stop loss price
   * @property {Number} [takeProfit] take profit price
   * @property {Number} [openPrice] pending or market order open price
   */ /**
   * CopyFactory external signal
   * @typedef {CopyFactoryExternalSignalUpdate} CopyFactoryExternalSignal
   * @property {String} id external signal id
   */ /**
   * CopyFactory external signal remove payload
   * @typedef {Object} CopyFactoryExternalSignalRemove
   * @property {Date} time the time signal was removed (closed) at
   */ /**
   * Returns active external signals of a strategy. Requires access to
   * copyfactory-api:rest:public:external-signals:getSignals method which is included into reader role.
   * Requires access to strategy, account resources.
   * @param {String} strategyId strategy id
   * @returns {Promise<Array<CopyFactoryExternalSignal>>}
   */ getExternalSignals() {
        const opts = {
            url: `/users/current/strategies/${this._strategyId}/external-signals`,
            method: "GET",
            headers: {
                "auth-token": this._domainClient.token
            },
            json: true
        };
        return this._domainClient.requestSignal(opts, this._host, this._accountId);
    }
    /**
   * Updates external signal for a strategy. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/trading/updateExternalSignal/
   * @param {String} signalId external signal id (should be 8 alphanumerical symbols)
   * @param {CopyFactoryExternalSignalUpdate} signal signal update payload
   * @return {Promise} promise which resolves when the external signal is updated
   */ updateExternalSignal(signalId, signal) {
        const opts = {
            url: `/users/current/strategies/${this._strategyId}/external-signals/${signalId}`,
            method: "PUT",
            headers: {
                "auth-token": this._domainClient.token
            },
            data: signal,
            json: true
        };
        return this._domainClient.requestSignal(opts, this._host, this._accountId);
    }
    /**
   * CopyFactory external signal remove payload
   * @typedef {Object} CopyFactoryExternalSignalRemove
   * @property {Date} time the time signal was removed (closed) at
   */ /**
   * Removes (closes) external signal for a strategy. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/trading/removeExternalSignal/
   * @param {String} signalId external signal id
   * @param {CopyFactoryExternalSignalRemove} signal signal removal payload
   * @return {Promise} promise which resolves when the external signal is removed
   */ removeExternalSignal(signalId, signal) {
        const opts = {
            url: `/users/current/strategies/${this._strategyId}/external-signals/${signalId}/remove`,
            method: "POST",
            headers: {
                "auth-token": this._domainClient.token
            },
            data: signal,
            json: true
        };
        return this._domainClient.requestSignal(opts, this._host, this._accountId);
    }
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjxhbm9uPiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcmFuZG9tc3RyaW5nIGZyb20gJ3JhbmRvbXN0cmluZyc7XG5cbi8qKlxuICogQ29weUZhY3RvcnkgY2xpZW50IGZvciBzdHJhdGVneSBzaWduYWwgcmVxdWVzdHNcbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU3RyYXRlZ3lTaWduYWxDbGllbnQge1xuXG4gIC8qKlxuICAgKiBDb25zdHJ1Y3RzIENvcHlGYWN0b3J5IHN0cmF0ZWd5IHNpZ25hbCBjbGllbnQgaW5zdGFuY2VcbiAgICogQHBhcmFtIHtzdHJpbmd9IGFjY291bnRJZCBzdHJhdGVneSBwcm92aWRlciBpZFxuICAgKiBAcGFyYW0ge3N0cmluZ30gc3RyYXRlZ3lJZCBzdHJhdGVneSBpZFxuICAgKiBAcGFyYW0ge09iamVjdH0gaG9zdCBob3N0IGRhdGFcbiAgICogQHBhcmFtIHtEb21haW5DbGllbnR9IGRvbWFpbkNsaWVudCBkb21haW4gY2xpZW50XG4gICAqL1xuICBjb25zdHJ1Y3RvcihhY2NvdW50SWQsIHN0cmF0ZWd5SWQsIGhvc3QsIGRvbWFpbkNsaWVudCkge1xuICAgIHRoaXMuX2FjY291bnRJZCA9IGFjY291bnRJZDtcbiAgICB0aGlzLl9zdHJhdGVneUlkID0gc3RyYXRlZ3lJZDtcbiAgICB0aGlzLl9kb21haW5DbGllbnQgPSBkb21haW5DbGllbnQ7XG4gICAgdGhpcy5faG9zdCA9IGhvc3Q7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGVzIHJhbmRvbSBzaWduYWwgaWRcbiAgICogQHJldHVybiB7U3RyaW5nfSBzaWduYWwgaWRcbiAgICovXG4gIGdlbmVyYXRlU2lnbmFsSWQoKSB7XG4gICAgcmV0dXJuIHJhbmRvbXN0cmluZy5nZW5lcmF0ZSg4KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb3B5RmFjdG9yeSBleHRlcm5hbCBzaWduYWwgdXBkYXRlIHBheWxvYWRcbiAgICogQHR5cGVkZWYge09iamVjdH0gQ29weUZhY3RvcnlFeHRlcm5hbFNpZ25hbFVwZGF0ZVxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gc3ltYm9sIHRyYWRlIHN5bWJvbFxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gdHlwZSB0cmFkZSB0eXBlIChvbmUgb2YgUE9TSVRJT05fVFlQRV9CVVksIFBPU0lUSU9OX1RZUEVfU0VMTCwgT1JERVJfVFlQRV9CVVlfTElNSVQsIE9SREVSX1RZUEVfU0VMTF9MSU1JVCwgXG4gICAqIE9SREVSX1RZUEVfQlVZX1NUT1AsIE9SREVSX1RZUEVfU0VMTF9TVE9QKVxuICAgKiBAcHJvcGVydHkge0RhdGV9IHRpbWUgdGltZSB0aGUgc2lnbmFsIHdhcyBlbWl0dGVkIGF0XG4gICAqIEBwcm9wZXJ0eSB7RGF0ZX0gW3VwZGF0ZVRpbWVdIGxhc3QgdGltZSBvZiB0aGUgc2lnbmFsIHVwZGF0ZVxuICAgKiBAcHJvcGVydHkge051bWJlcn0gdm9sdW1lIHZvbHVtZSB0cmFkZWRcbiAgICogQHByb3BlcnR5IHtOdW1iZXJ9IFttYWdpY10gZXhwZXJ0IGFkdmlzb3IgaWRcbiAgICogQHByb3BlcnR5IHtOdW1iZXJ9IFtzdG9wTG9zc10gc3RvcCBsb3NzIHByaWNlXG4gICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBbdGFrZVByb2ZpdF0gdGFrZSBwcm9maXQgcHJpY2VcbiAgICogQHByb3BlcnR5IHtOdW1iZXJ9IFtvcGVuUHJpY2VdIHBlbmRpbmcgb3IgbWFya2V0IG9yZGVyIG9wZW4gcHJpY2VcbiAgICovXG5cbiAgLyoqXG4gICAqIENvcHlGYWN0b3J5IGV4dGVybmFsIHNpZ25hbFxuICAgKiBAdHlwZWRlZiB7Q29weUZhY3RvcnlFeHRlcm5hbFNpZ25hbFVwZGF0ZX0gQ29weUZhY3RvcnlFeHRlcm5hbFNpZ25hbFxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gaWQgZXh0ZXJuYWwgc2lnbmFsIGlkXG4gICAqL1xuXG4gIC8qKlxuICAgKiBDb3B5RmFjdG9yeSBleHRlcm5hbCBzaWduYWwgcmVtb3ZlIHBheWxvYWRcbiAgICogQHR5cGVkZWYge09iamVjdH0gQ29weUZhY3RvcnlFeHRlcm5hbFNpZ25hbFJlbW92ZVxuICAgKiBAcHJvcGVydHkge0RhdGV9IHRpbWUgdGhlIHRpbWUgc2lnbmFsIHdhcyByZW1vdmVkIChjbG9zZWQpIGF0XG4gICAqL1xuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGFjdGl2ZSBleHRlcm5hbCBzaWduYWxzIG9mIGEgc3RyYXRlZ3kuIFJlcXVpcmVzIGFjY2VzcyB0b1xuICAgKiBjb3B5ZmFjdG9yeS1hcGk6cmVzdDpwdWJsaWM6ZXh0ZXJuYWwtc2lnbmFsczpnZXRTaWduYWxzIG1ldGhvZCB3aGljaCBpcyBpbmNsdWRlZCBpbnRvIHJlYWRlciByb2xlLlxuICAgKiBSZXF1aXJlcyBhY2Nlc3MgdG8gc3RyYXRlZ3ksIGFjY291bnQgcmVzb3VyY2VzLlxuICAgKiBAcGFyYW0ge1N0cmluZ30gc3RyYXRlZ3lJZCBzdHJhdGVneSBpZFxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxBcnJheTxDb3B5RmFjdG9yeUV4dGVybmFsU2lnbmFsPj59XG4gICAqL1xuICBnZXRFeHRlcm5hbFNpZ25hbHMoKSB7XG4gICAgY29uc3Qgb3B0cyA9IHtcbiAgICAgIHVybDogYC91c2Vycy9jdXJyZW50L3N0cmF0ZWdpZXMvJHt0aGlzLl9zdHJhdGVneUlkfS9leHRlcm5hbC1zaWduYWxzYCxcbiAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdhdXRoLXRva2VuJzogdGhpcy5fZG9tYWluQ2xpZW50LnRva2VuXG4gICAgICB9LFxuICAgICAganNvbjogdHJ1ZVxuICAgIH07XG5cbiAgICByZXR1cm4gdGhpcy5fZG9tYWluQ2xpZW50LnJlcXVlc3RTaWduYWwob3B0cywgdGhpcy5faG9zdCwgdGhpcy5fYWNjb3VudElkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIGV4dGVybmFsIHNpZ25hbCBmb3IgYSBzdHJhdGVneS4gU2VlXG4gICAqIGh0dHBzOi8vbWV0YWFwaS5jbG91ZC9kb2NzL2NvcHlmYWN0b3J5L3Jlc3RBcGkvYXBpL3RyYWRpbmcvdXBkYXRlRXh0ZXJuYWxTaWduYWwvXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBzaWduYWxJZCBleHRlcm5hbCBzaWduYWwgaWQgKHNob3VsZCBiZSA4IGFscGhhbnVtZXJpY2FsIHN5bWJvbHMpXG4gICAqIEBwYXJhbSB7Q29weUZhY3RvcnlFeHRlcm5hbFNpZ25hbFVwZGF0ZX0gc2lnbmFsIHNpZ25hbCB1cGRhdGUgcGF5bG9hZFxuICAgKiBAcmV0dXJuIHtQcm9taXNlfSBwcm9taXNlIHdoaWNoIHJlc29sdmVzIHdoZW4gdGhlIGV4dGVybmFsIHNpZ25hbCBpcyB1cGRhdGVkXG4gICAqL1xuICB1cGRhdGVFeHRlcm5hbFNpZ25hbChzaWduYWxJZCwgc2lnbmFsKSB7XG4gICAgY29uc3Qgb3B0cyA9IHtcbiAgICAgIHVybDogYC91c2Vycy9jdXJyZW50L3N0cmF0ZWdpZXMvJHt0aGlzLl9zdHJhdGVneUlkfS9leHRlcm5hbC1zaWduYWxzLyR7c2lnbmFsSWR9YCxcbiAgICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdhdXRoLXRva2VuJzogdGhpcy5fZG9tYWluQ2xpZW50LnRva2VuXG4gICAgICB9LFxuICAgICAgZGF0YTogc2lnbmFsLFxuICAgICAganNvbjogdHJ1ZVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuX2RvbWFpbkNsaWVudC5yZXF1ZXN0U2lnbmFsKG9wdHMsIHRoaXMuX2hvc3QsIHRoaXMuX2FjY291bnRJZCk7XG4gIH1cblxuICAvKipcbiAgICogQ29weUZhY3RvcnkgZXh0ZXJuYWwgc2lnbmFsIHJlbW92ZSBwYXlsb2FkXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IENvcHlGYWN0b3J5RXh0ZXJuYWxTaWduYWxSZW1vdmVcbiAgICogQHByb3BlcnR5IHtEYXRlfSB0aW1lIHRoZSB0aW1lIHNpZ25hbCB3YXMgcmVtb3ZlZCAoY2xvc2VkKSBhdFxuICAgKi9cblxuICAvKipcbiAgICogUmVtb3ZlcyAoY2xvc2VzKSBleHRlcm5hbCBzaWduYWwgZm9yIGEgc3RyYXRlZ3kuIFNlZVxuICAgKiBodHRwczovL21ldGFhcGkuY2xvdWQvZG9jcy9jb3B5ZmFjdG9yeS9yZXN0QXBpL2FwaS90cmFkaW5nL3JlbW92ZUV4dGVybmFsU2lnbmFsL1xuICAgKiBAcGFyYW0ge1N0cmluZ30gc2lnbmFsSWQgZXh0ZXJuYWwgc2lnbmFsIGlkXG4gICAqIEBwYXJhbSB7Q29weUZhY3RvcnlFeHRlcm5hbFNpZ25hbFJlbW92ZX0gc2lnbmFsIHNpZ25hbCByZW1vdmFsIHBheWxvYWRcbiAgICogQHJldHVybiB7UHJvbWlzZX0gcHJvbWlzZSB3aGljaCByZXNvbHZlcyB3aGVuIHRoZSBleHRlcm5hbCBzaWduYWwgaXMgcmVtb3ZlZFxuICAgKi9cbiAgcmVtb3ZlRXh0ZXJuYWxTaWduYWwoc2lnbmFsSWQsIHNpZ25hbCkge1xuICAgIGNvbnN0IG9wdHMgPSB7XG4gICAgICB1cmw6IGAvdXNlcnMvY3VycmVudC9zdHJhdGVnaWVzLyR7dGhpcy5fc3RyYXRlZ3lJZH0vZXh0ZXJuYWwtc2lnbmFscy8ke3NpZ25hbElkfS9yZW1vdmVgLFxuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdhdXRoLXRva2VuJzogdGhpcy5fZG9tYWluQ2xpZW50LnRva2VuXG4gICAgICB9LFxuICAgICAgZGF0YTogc2lnbmFsLFxuICAgICAganNvbjogdHJ1ZVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuX2RvbWFpbkNsaWVudC5yZXF1ZXN0U2lnbmFsKG9wdHMsIHRoaXMuX2hvc3QsIHRoaXMuX2FjY291bnRJZCk7XG4gIH1cblxufSJdLCJuYW1lcyI6WyJTdHJhdGVneVNpZ25hbENsaWVudCIsImNvbnN0cnVjdG9yIiwiYWNjb3VudElkIiwic3RyYXRlZ3lJZCIsImhvc3QiLCJkb21haW5DbGllbnQiLCJfYWNjb3VudElkIiwiX3N0cmF0ZWd5SWQiLCJfZG9tYWluQ2xpZW50IiwiX2hvc3QiLCJnZW5lcmF0ZVNpZ25hbElkIiwicmFuZG9tc3RyaW5nIiwiZ2VuZXJhdGUiLCJnZXRFeHRlcm5hbFNpZ25hbHMiLCJvcHRzIiwidXJsIiwibWV0aG9kIiwiaGVhZGVycyIsInRva2VuIiwianNvbiIsInJlcXVlc3RTaWduYWwiLCJ1cGRhdGVFeHRlcm5hbFNpZ25hbCIsInNpZ25hbElkIiwic2lnbmFsIiwiZGF0YSIsInJlbW92ZUV4dGVybmFsU2lnbmFsIl0sIm1hcHBpbmdzIjoiOzs7OytCQUVBOztDQUVDLEdBQ0Q7OztlQUFxQkE7OztxRUFMSTs7Ozs7O0FBS1YsSUFBQSxBQUFNQSx1QkFBTixNQUFNQTtJQUVuQjs7Ozs7O0dBTUMsR0FDREMsWUFBWUMsU0FBUyxFQUFFQyxVQUFVLEVBQUVDLElBQUksRUFBRUMsWUFBWSxDQUFFO1FBQ3JELElBQUksQ0FBQ0MsVUFBVSxHQUFHSjtRQUNsQixJQUFJLENBQUNLLFdBQVcsR0FBR0o7UUFDbkIsSUFBSSxDQUFDSyxhQUFhLEdBQUdIO1FBQ3JCLElBQUksQ0FBQ0ksS0FBSyxHQUFHTDtJQUNmO0lBRUE7OztHQUdDLEdBQ0RNLG1CQUFtQjtRQUNqQixPQUFPQyxxQkFBWSxDQUFDQyxRQUFRLENBQUM7SUFDL0I7SUFFQTs7Ozs7Ozs7Ozs7OztHQWFDLEdBRUQ7Ozs7R0FJQyxHQUVEOzs7O0dBSUMsR0FFRDs7Ozs7O0dBTUMsR0FDREMscUJBQXFCO1FBQ25CLE1BQU1DLE9BQU87WUFDWEMsS0FBSyxDQUFDLDBCQUEwQixFQUFFLElBQUksQ0FBQ1IsV0FBVyxDQUFDLGlCQUFpQixDQUFDO1lBQ3JFUyxRQUFRO1lBQ1JDLFNBQVM7Z0JBQ1AsY0FBYyxJQUFJLENBQUNULGFBQWEsQ0FBQ1UsS0FBSztZQUN4QztZQUNBQyxNQUFNLElBQUk7UUFDWjtRQUVBLE9BQU8sSUFBSSxDQUFDWCxhQUFhLENBQUNZLGFBQWEsQ0FBQ04sTUFBTSxJQUFJLENBQUNMLEtBQUssRUFBRSxJQUFJLENBQUNILFVBQVU7SUFDM0U7SUFFQTs7Ozs7O0dBTUMsR0FDRGUscUJBQXFCQyxRQUFRLEVBQUVDLE1BQU0sRUFBRTtRQUNyQyxNQUFNVCxPQUFPO1lBQ1hDLEtBQUssQ0FBQywwQkFBMEIsRUFBRSxJQUFJLENBQUNSLFdBQVcsQ0FBQyxrQkFBa0IsRUFBRWUsU0FBUyxDQUFDO1lBQ2pGTixRQUFRO1lBQ1JDLFNBQVM7Z0JBQ1AsY0FBYyxJQUFJLENBQUNULGFBQWEsQ0FBQ1UsS0FBSztZQUN4QztZQUNBTSxNQUFNRDtZQUNOSixNQUFNLElBQUk7UUFDWjtRQUNBLE9BQU8sSUFBSSxDQUFDWCxhQUFhLENBQUNZLGFBQWEsQ0FBQ04sTUFBTSxJQUFJLENBQUNMLEtBQUssRUFBRSxJQUFJLENBQUNILFVBQVU7SUFDM0U7SUFFQTs7OztHQUlDLEdBRUQ7Ozs7OztHQU1DLEdBQ0RtQixxQkFBcUJILFFBQVEsRUFBRUMsTUFBTSxFQUFFO1FBQ3JDLE1BQU1ULE9BQU87WUFDWEMsS0FBSyxDQUFDLDBCQUEwQixFQUFFLElBQUksQ0FBQ1IsV0FBVyxDQUFDLGtCQUFrQixFQUFFZSxTQUFTLE9BQU8sQ0FBQztZQUN4Rk4sUUFBUTtZQUNSQyxTQUFTO2dCQUNQLGNBQWMsSUFBSSxDQUFDVCxhQUFhLENBQUNVLEtBQUs7WUFDeEM7WUFDQU0sTUFBTUQ7WUFDTkosTUFBTSxJQUFJO1FBQ1o7UUFDQSxPQUFPLElBQUksQ0FBQ1gsYUFBYSxDQUFDWSxhQUFhLENBQUNOLE1BQU0sSUFBSSxDQUFDTCxLQUFLLEVBQUUsSUFBSSxDQUFDSCxVQUFVO0lBQzNFO0FBRUYifQ==